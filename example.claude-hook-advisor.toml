# Claude Hook Advisor Configuration Example
# This file shows various command mapping examples for different use cases
#
# ===== IMPORTANT: How Command Matching Works =====
# Commands are matched ONLY at the start of the line (primary command position).
# This ensures mappings apply to the main command, not subcommands or arguments.
#
# Examples:
#   ✅ "npm install"    → matches "npm" → becomes "bun install"
#   ✅ "npm start"      → matches "npm" → becomes "bun start"
#   ❌ "npx npm"        → does NOT match "npm" (not primary command)
#   ❌ "npm-check"      → does NOT match "npm" (different command)
#   ❌ "git rm file"    → does NOT match "rm" (rm is a subcommand)
#
# This prevents unintended replacements and keeps your command mappings predictable.

[commands]
# ===== Node.js / JavaScript Development =====
# Prefer Bun over npm/yarn for faster package management
npm = "bun"
yarn = "bun"
pnpm = "bun"
npx = "bunx"

# ===== Python Development =====
# Use uv for faster Python package management
pip = "uv pip"
"pip install" = "uv add"
"pip uninstall" = "uv remove"
python = "uv run python"

# ===== Modern CLI Tool Replacements =====
# Replace traditional tools with modern alternatives
cat = "bat"                    # Syntax highlighting
ls = "eza"                     # Better file listing
find = "fd"                    # Faster file search
grep = "rg"                    # Faster text search (ripgrep)
curl = "wget --verbose"        # Alternative HTTP client
wget = "curl -L"               # Alternative download tool

# ===== Git Shortcuts =====
# Encourage better git practices
"git push" = "git push --set-upstream origin HEAD"
"git commit" = "git commit -S"  # Always sign commits

# ===== Docker Alternatives =====
# Use Podman instead of Docker
docker = "podman"
"docker-compose" = "podman-compose"

# ===== Build Tools =====
# Prefer modern build tools
make = "just"                  # Modern command runner
cmake = "meson"               # Modern build system

# ===== Text Editors =====
# Encourage modern editors
vim = "nvim"                  # Neovim instead of vim
nano = "micro"                # Modern terminal editor

# ===== System Monitoring =====
# Modern system tools
top = "htop"                  # Better process viewer
ps = "procs"                  # Modern process viewer
du = "dust"                   # Better disk usage

# ===== Network Tools =====
# Modern networking tools
ping = "gping"                # Graphical ping
netstat = "ss"                # Modern socket statistics

# ===== File Operations =====
# Safer file operations
# NOTE: "rm" mapping only affects direct "rm" commands, not "git rm" or other subcommands
rm = "trash"                  # Move to trash instead of permanent delete
cp = "cp -i"                  # Interactive copy (ask before overwrite)
mv = "mv -i"                  # Interactive move (ask before overwrite)

# ===== Package Managers by OS =====
# Encourage consistent package managers
apt = "nala"                  # Better apt frontend
yum = "dnf"                   # Modern Red Hat package manager
brew = "brew"                 # Keep Homebrew as-is (already good)

# ===== Development Servers =====
# Use modern development servers
"python -m http.server" = "python -m http.server --bind 127.0.0.1"  # Bind to localhost only
"php -S" = "php -S 127.0.0.1:8000"  # Secure PHP dev server

# ===== Security Tools =====
# Encourage secure practices
ssh = "ssh -o VerifyHostKeyDNS=yes"  # Verify host keys via DNS
scp = "rsync -avz --progress"        # Use rsync instead of scp

# ===== Custom Project Commands =====
# Project-specific shortcuts (examples)
"npm start" = "bun dev"              # Use bun for dev server
"npm test" = "bun test --watch"      # Watch mode for tests
"npm run build" = "bun run build:prod"  # Production build

# ===== Dangerous Command Replacements =====
# Prevent accidental damage
"rm -rf" = "echo 'Use trash command instead of rm -rf for safety'"
"sudo rm" = "echo 'Consider using trash or be very careful with sudo rm'"
"chmod 777" = "echo 'chmod 777 is dangerous, consider more restrictive permissions'"

# ===== Environment-Specific =====
# Different tools for different environments
"kubectl" = "k9s"                   # Better Kubernetes interface
"terraform" = "tofu"                # OpenTofu instead of Terraform
"aws" = "aws --cli-auto-prompt"     # AWS CLI with auto-prompt

# ===== Semantic Directory Aliasing =====
# Map semantic names to actual filesystem paths
[semantic_directories]
# Standard documentation directories
docs = "~/Documents/Documentation"
central_docs = "~/Documents/Documentation"
project_docs = "~/Documents/Documentation/my-project"
claude_docs = "~/Documents/Documentation/claude"

# Development directories
src = "./src"
lib = "./lib"
tests = "./tests"
configs = "./config"
scripts = "./scripts"

# Project-specific directories
api_docs = "~/Documents/Documentation/my-project/api"
user_guides = "~/Documents/Documentation/my-project/guides"
examples = "~/Documents/Documentation/my-project/examples"

# Natural language aliases (requires quotes for spaces)
"project docs" = "~/Documents/Documentation/my-project"
"api documentation" = "~/Documents/Documentation/my-project/api"
"user guides" = "~/Documents/Documentation/my-project/guides"
"code examples" = "~/Documents/Documentation/my-project/examples"
"config files" = "./config"
"test files" = "./tests"

# Personal knowledge management
notes = "~/Documents/Notes"
research = "~/Documents/Research"
bookmarks = "~/Documents/Bookmarks"

# ===== Command History Tracking =====
# Track all Bash commands Claude runs to a SQLite database
[command_history]
enabled = true
log_file = "~/.claude-hook-advisor/bash-history.db"

# View history with:
#   claude-hook-advisor --history                  # Show recent commands
#   claude-hook-advisor --history --limit 50       # Show last 50 commands
#   claude-hook-advisor --history --failures       # Show only failed commands
#   claude-hook-advisor --history --pattern git    # Show git commands
#   claude-hook-advisor --history --session <ID>   # Show specific session

# ===== Security Pattern Detection =====
# Detect potentially dangerous code patterns in file edits
# Warnings are shown once per session to avoid noise

[[security_patterns]]
rule_name = "github_actions_workflow"
path_pattern = ".github/workflows/*.yml"
reminder = """⚠️ Security Warning: You are editing a GitHub Actions workflow file.

Be aware of these security risks:
1. **Command Injection**: Never use untrusted input (issue titles, PR descriptions, commit messages) directly in run: commands
2. **Use environment variables**: Instead of ${{ github.event.issue.title }}, use env: with proper quoting

Example of UNSAFE pattern:
  run: echo "${{ github.event.issue.title }}"

Example of SAFE pattern:
  env:
    TITLE: ${{ github.event.issue.title }}
  run: echo "$TITLE"

Risky inputs: github.event.issue.*, github.event.pull_request.*, github.event.comment.*, github.head_ref"""

[[security_patterns]]
rule_name = "github_actions_workflow_yaml"
path_pattern = ".github/workflows/*.yaml"
reminder = """⚠️ Security Warning: You are editing a GitHub Actions workflow file.

Be aware of these security risks:
1. **Command Injection**: Never use untrusted input (issue titles, PR descriptions, commit messages) directly in run: commands
2. **Use environment variables**: Instead of ${{ github.event.issue.title }}, use env: with proper quoting

Example of UNSAFE pattern:
  run: echo "${{ github.event.issue.title }}"

Example of SAFE pattern:
  env:
    TITLE: ${{ github.event.issue.title }}
  run: echo "$TITLE"

Risky inputs: github.event.issue.*, github.event.pull_request.*, github.event.comment.*, github.head_ref"""

[[security_patterns]]
rule_name = "eval_injection"
content_substrings = ["eval("]
reminder = """⚠️ Security Warning: eval() executes arbitrary code and is a major security risk.

Consider using JSON.parse() for data parsing or alternative design patterns that don't require code evaluation.
Only use eval() if you truly need to evaluate arbitrary code."""

[[security_patterns]]
rule_name = "new_function_injection"
content_substrings = ["new Function"]
reminder = """⚠️ Security Warning: Using new Function() with dynamic strings can lead to code injection vulnerabilities.

Consider alternative approaches that don't evaluate arbitrary code.
Only use new Function() if you truly need to evaluate arbitrary dynamic code."""

[[security_patterns]]
rule_name = "react_dangerously_set_html"
content_substrings = ["dangerouslySetInnerHTML"]
reminder = """⚠️ Security Warning: dangerouslySetInnerHTML can lead to XSS vulnerabilities if used with untrusted content.

Ensure all content is properly sanitized using an HTML sanitizer library like DOMPurify, or use safe alternatives."""

[[security_patterns]]
rule_name = "document_write_xss"
content_substrings = ["document.write"]
reminder = """⚠️ Security Warning: document.write() can be exploited for XSS attacks and has performance issues.

Use DOM manipulation methods like createElement() and appendChild() instead."""

[[security_patterns]]
rule_name = "innerHTML_xss"
content_substrings = [".innerHTML =", ".innerHTML="]
reminder = """⚠️ Security Warning: Setting innerHTML with untrusted content can lead to XSS vulnerabilities.

Use textContent for plain text or safe DOM methods for HTML content.
If you need HTML support, consider using an HTML sanitizer library such as DOMPurify."""

[[security_patterns]]
rule_name = "child_process_exec"
content_substrings = ["child_process.exec", "exec(", "execSync("]
reminder = """⚠️ Security Warning: Using child_process.exec() can lead to command injection vulnerabilities.

Instead of:
  exec(`command ${userInput}`)

Use:
  import { execFile } from 'child_process'
  execFile('command', [userInput])

The execFile function:
- Uses execFile instead of exec (prevents shell injection)
- Handles arguments as an array (safer than string interpolation)
- Provides proper error handling

Only use exec() if you absolutely need shell features and the input is guaranteed to be safe."""

[[security_patterns]]
rule_name = "pickle_deserialization"
content_substrings = ["pickle.loads", "pickle.load"]
reminder = """⚠️ Security Warning: Using pickle with untrusted content can lead to arbitrary code execution.

Consider using JSON or other safe serialization formats instead.
Only use pickle if it is explicitly needed or requested by the user."""

[[security_patterns]]
rule_name = "os_system_injection"
content_substrings = ["os.system(", "from os import system"]
reminder = """⚠️ Security Warning: os.system() can lead to command injection vulnerabilities.

Use subprocess.run() with a list of arguments instead:
  subprocess.run(['command', arg1, arg2])

This should only be used with static arguments and never with arguments that could be user-controlled."""

[[security_patterns]]
rule_name = "sql_injection"
content_substrings = ["execute(\"", "execute('", "executemany(\"", "executemany('"]
reminder = """⚠️ Security Warning: String interpolation in SQL queries can lead to SQL injection vulnerabilities.

Instead of:
  cursor.execute(f"SELECT * FROM users WHERE name = '{user_input}'")

Use parameterized queries:
  cursor.execute("SELECT * FROM users WHERE name = ?", (user_input,))

Always use parameter substitution for user-controlled values."""